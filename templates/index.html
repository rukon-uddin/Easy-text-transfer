<!DOCTYPE html>
<html>
<head>
    <title>Text Communication</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <div class="text-center">
        <h1>Text Communication</h1>
        <textarea id="textArea" class="w-50" rows="3"></textarea>
    </div>
    <div class="text-center">
        <button id="sendButton" type="button" class="btn btn-primary btn-lg">Share</button>
    </div>
    <div id="receivedText" class="text-center mt-5">
        <input type="text" style="width: 30%;" value="Hello World" id="myInput">
    </div>
    <div class="text-center">
        <button onclick=copyFunction() type="button" class="btn btn-success mt-2">Copy</button>
    </div>
    
    <script>
        const textArea = document.getElementById('textArea');
        const sendButton = document.getElementById('sendButton');
        const receivedText = document.getElementById('myInput');
        function copyFunction() {
            // Get the text field
            var copyText = receivedText

            // Select the text field
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            // Copy the text inside the text field
            navigator.clipboard.writeText(copyText.value);
        }
        sendButton.addEventListener('click', () => {
            const text = textArea.value;
            fetch('/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: text })
            });
            textArea.value = '';
        });

        function updateReceivedText(text) {
            receivedText.value = text;
        }

        function pollForText() {
            fetch('/receive')
                .then(response => response.json())
                .then(data => {
                    if (data.text) {
                        updateReceivedText(data.text);
                    }
                    setTimeout(pollForText, 1000);
                });
        }

        pollForText();
    </script>
</body>
</html>
